<!DOCTYPE html>
<html>
	<head>
		<title>My A-Frame Scene</title>
		<script type="text/javascript" src="aframe.min.js"></script>
		<script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
		<script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
		<!-- <script src="https://unpkg.com/vanilla-picker@2"></script> -->
		<!-- <script src="https://rawgit.com/rdub80/aframe-gui/master/dist/aframe-gui.min.js"></script> -->
		<!-- <script
			src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"
			type="text/javascript"
		></script> -->
		<!-- <link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
			integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w=="
			crossorigin="anonymous"
			referrerpolicy="no-referrer"
		/> -->
	</head>

	<body>
		<a-scene>
			<a-assets>
				<a-asset-item
					id="maserati"
					src="assets/maserati_quattroporte.glb"
				></a-asset-item>
				<a-asset-item id="supra" src="assets/toyota_supra.glb"></a-asset-item>
				<a-asset-item id="bmw" src="assets/ac_-_bmw_1m.glb"></a-asset-item>
				<a-asset-item
					id="alfa-romeo"
					src="assets/ac_-_alfa_romeo_giulietta_qv.glb"
				></a-asset-item>
				<a-asset-item
					id="lotus"
					src="assets/ac_-_lotus_exige_240.glb"
				></a-asset-item>
				<a-asset-item
					id="audi"
					src="assets/ac_-_audi_r8_lms_2016.glb"
				></a-asset-item>
				<a-asset-item
					id="showroom1"
					src="assets/car-showroom_2.glb"
				></a-asset-item>
				<img
					crossorigin="anonymous"
					id="turnTableTexture"
					src="assets/metal_background.jpg"
				/>
				<img id="brush" src="assets/brush.png" />
				<img id="view" src="assets/camera.png" />
				<a-asset-item
					id="man"
					src="assets/business_man_-_low_polygon_game_character.glb"
				></a-asset-item>
				<!-- <a-asset-item id="" src="assets/fa-brands-400.ttf"></a-asset-item> -->
			</a-assets>

			<a-camera id="ext_cam" position="0 1.6 0" active="true">
				<a-cursor color="white" scale="1 1 1"></a-cursor>
				<!-- <a-gui-cursor
					id="cursor"
					raycaster="objects: [gui-interactable]"
					fuse="true"
					fuse-timeout="1000"
					color="#ECEFF1"
					hover-color="#CFD8DC"
					active-color="#607D8B"
					design="ring"
				>
				</a-gui-cursor> -->
			</a-camera>

			<a-entity gltf-model="#showroom1">
				<!--       turn table with texture -->
				<!-- <a-cylinder
					material="src: #brush"
					rotation="90 0 0"
					scale="0.08 0.08 0.08"
					position="0 1.6 0"
				></a-cylinder> -->

				<a-box
					width="0.45"
					height="0.3"
					roation="0 0 0"
					depth="0.05"
					position="0 1.2 0"
					material="color: #ffffff; opacity: 0"
					move
					look-at="#ext_cam"
					scale="0.5 0.5 0.5"
				>
					<a-entity id="row1" position="0.05 0.12 0"
						><a-sphere
							radius="0.05"
							material="color: #0d1116"
							position="-0.24 0 0"
							gui-interactable
							sphere-set-color
						></a-sphere>
						<a-sphere
							radius="0.05"
							material="color: #c2c4c6"
							position="-0.12 0 0"
							gui-interactable
							sphere-set-color
						></a-sphere>
						<a-sphere
							radius="0.05"
							material="color: #7a6440"
							position="0 0 0"
							gui-interactable
							sphere-set-color
						></a-sphere>
						<a-sphere
							radius="0.05"
							material="color: #d3d3d3"
							position="0.12 0 0"
							gui-interactable
							sphere-set-color
						></a-sphere>
					</a-entity>
					<a-entity id="row2" position="0.05 0 0"
						><a-sphere
							radius="0.05"
							material="color: #c00e1a"
							position="-0.24 0 0"
							gui-interactable
							sphere-set-color
						></a-sphere>
						<a-sphere
							radius="0.05"
							material="color: #49111d"
							position="-0.12 0 0"
							gui-interactable
							sphere-set-color
						></a-sphere>
						<a-sphere
							radius="0.05"
							material="color: #f78616"
							position="0 0 0"
							gui-interactable
							sphere-set-color
						></a-sphere>
						<a-sphere
							radius="0.05"
							material="color: #155c2d"
							position="0.12 0 0"
							gui-interactable
							sphere-set-color
						></a-sphere>
					</a-entity>
					<a-entity id="row3" position="0.05 -0.12 0"
						><a-sphere
							radius="0.05"
							material="color: #65867f"
							position="-0.24 0 0"
							gui-interactable
							sphere-set-color
						></a-sphere>
						<a-sphere
							radius="0.05"
							material="color: #76afbe"
							position="-0.12 0 0"
							gui-interactable
							sphere-set-color
						></a-sphere>
						<a-sphere
							radius="0.05"
							material="color: #112552"
							position="0 0 0"
							gui-interactable
							sphere-set-color
						></a-sphere>
						<a-sphere
							radius="0.05"
							material="color: #dfd5b2"
							position="0.12 0 0"
							gui-interactable
							sphere-set-color
						></a-sphere>
					</a-entity>
				</a-box>

				<a-entity
					gltf-model="#man"
					position="4.531 0.127 -2.702"
					scale="0.8 0.8 0.8"
					rotation="0 -22 0"
					animation-mixer="clip:Rig|idle"
					look-at="#ext_cam"
				>
				</a-entity>

				<a-entity position="8 0 7">
					<a-cylinder
						id="maserati_int_cam_switch_1"
						scale="0.05 0.05 0.05"
						color="white"
						position="0.5 0.6 -3.2"
						rotation="-60 0 0"
						material="src: #view"
						gui-interactable
					></a-cylinder>
					<!-- <a-sphere
						color="#696969"
						radius="0.05"
						position="0.8 0.6 -3"
						change-color="color: #696969; component:rim; name: maserati_gltf"
						gui-interactable
					></a-sphere>
					<a-sphere
						color="#808080"
						radius="0.05"
						position="1 0.6 -3"
						change-color="color: #808080; component:rim; name:maserati_gltf"
						gui-interactable
					></a-sphere> -->
					<!-- <a-cylinder
						material="src: #brush"
						rotation="90 0 0"
						scale="0.08 0.08 0.08"
						position="0.8 0.6 -3"
						change-color="color: #808080; component:rim; name:maserati_gltf"
						gui-interactable
					></a-cylinder> -->
					<a-cylinder
						material="src:#turnTableTexture"
						radius="3"
						height="0.1"
						animation="property: rotation; to: 0 360 0; loop:true; easing:linear; dur:30000"
					>
						<a-entity
							gltf-model="#maserati"
							id="maserati_gltf"
							position="0 0 0.1"
							modify-materials
						>
							<a-entity
								><a-camera
									id="maserati_interior_cam"
									position="0 1.4 -0.5"
									active="false"
								>
									<!-- <a-gui-cursor
										id="cursor"
										raycaster="objects: [gui-interactable]"
										fuse="true"
										fuse-timeout="2000"
										color="#ECEFF1"
										hover-color="#CFD8DC"
										active-color="#607D8B"
										design="ring"
									>
									</a-gui-cursor> -->
									<a-cursor color="white" scale="1 1 1"></a-cursor> </a-camera
							></a-entity>
							<a-cylinder
								id="maserati_ext_cam_switch"
								scale="0.04 0.04 0.04"
								position="0 1.2 0.5"
								color="white"
								gui-interactable
								rotation="-90 0 0"
								material="src: #view"
							></a-cylinder>

							<a-sphere
								color="#696969"
								radius="0.025"
								position="-0.5 1.2 0.5"
								change-color="color: #ff0000; component:leather; exclude:wheel"
								gui-interactable
							></a-sphere>
							<a-sphere
								color="#808080"
								radius="0.025"
								position="-0.7 1.2 0.5"
								change-color="color: #000000; component:leather; exclude:wheel"
								id="grey_leather"
								gui-interactable
							></a-sphere>
							<a-cylinder
								material="src: #brush"
								rotation="90 -90 0"
								scale="0.08 0.08 0.08"
								position="1.113 0.4 -1.745"
								change-color="color: #808080; component:rim; name:maserati_gltf"
								gui-interactable
							></a-cylinder>
							<a-cylinder
								material="src: #brush"
								rotation="90 -90 0"
								scale="0.08 0.08 0.08"
								position="0.115 1.851 -0.439"
								change-color="color: #808080; component:carpaint; name:maserati_gltf"
								gui-interactable
							></a-cylinder>
						</a-entity>
					</a-cylinder>
				</a-entity>

				<!-- <a-cylinder
          material="src:#turnTableTexture"
          position="2 0 7"
          radius="3"
          height="0.1"
          animation="property: rotation; to: 0 360 0; loop:true; easing:linear; dur:30000"
        >
          <a-entity gltf-model="#bmw" id="bmw_gltf" >
            <a-camera
              id="bmw_interior_cam"
              position="0 1.4 -0.5"
              active="false"
            >
              <a-cursor color="white" scale="1 1 1"></a-cursor>
            </a-camera>
            <a-box
              id="bmw_ext_cam_switch"
              scale="0.05 0.05 0.05"
              position="0 1.2 0.5"
              color="white"
              animation="property:rotation; to: 0 360 0; loop:true; easing:linear; dur:10000"
            ></a-box>

            <a-sphere
              color="#696969"
              radius="0.025"
              position="-0.5 1.2 0.5"
              change-color="color: #ff0000; component:leather; exclude:wheel; name: bmw_gltf"
            ></a-sphere>
            <a-sphere
              color="#808080"
              radius="0.025"
              position="-0.7 1.2 0.5"
              change-color="color: #000000; component:leather; name: bmw_gltf"
              id="dark_leather"
            ></a-sphere>
          </a-entity>
        </a-cylinder> -->
				<a-entity position="8 0 -3">
					<a-box
						id="supra_int_cam_switch"
						scale="0.05 0.05 0.05"
						color="white"
						position="0.5 0.6 -3"
						animation="property:rotation; to: 0 360 0; loop:true; easing:linear; dur:10000"
					></a-box>
					<a-sphere
						color="#696969"
						radius="0.05"
						position="0.8 0.6 -3"
						change-color="color: #696969; component:carpaint; name: supra_gltf"
					></a-sphere>
					<a-sphere
						color="#808080"
						radius="0.05"
						position="1 0.6 -3"
						change-color="color: #808080; component:carpaint; name:supra_gltf"
					></a-sphere>
					<a-cylinder
						material="src:#turnTableTexture"
						radius="3"
						height="0.1"
						animation="property: rotation; to: 0 360 0; loop:true; easing:linear; dur:30000"
					>
						<a-entity
							gltf-model="#supra"
							id="supra_gltf"
							position="0 0.1 0"
							modify-materials
						>
							<a-camera
								id="supra_interior_cam"
								position="0 1.2 0.5"
								active="false"
							>
								<a-cursor color="white" scale="1 1 1"></a-cursor>
							</a-camera>
							<a-box
								id="supra_ext_cam_switch"
								scale="0.05 0.05 0.05"
								position="0 1.2 0.5"
								color="white"
								animation="property:rotation; to: 0 360 0; loop:true; easing:linear; dur:10000"
							></a-box>

							<a-sphere
								color="#696969"
								radius="0.025"
								position="-0.5 1.2 0.5"
								change-color="color: #ff0000; component:leather; exclude:wheel"
							></a-sphere>
							<a-sphere
								color="#808080"
								radius="0.025"
								position="-0.7 1.2 0.5"
								change-color="color: #000000; component:leather"
								id="grey_leather"
							></a-sphere>
						</a-entity>
					</a-cylinder>
				</a-entity>
			</a-entity>
		</a-scene>
	</body>
	<!-- load the script after the body to not have undefined javascript erros -->
	<script>
		var color = '#ffffff';
		var leather_pick = 1;
		var colors = ['#000000', '#ffffff'];
		AFRAME.registerComponent('move', {
			schema: {
				speed: {
					type: 'number',
					default: 2,
				},
			},
			init: function () {
				this.chase = false;
				var btn = document.querySelector('a-sphere');
				this.target = this.el.sceneEl.querySelector('a-camera');

				btn.addEventListener('click', (e) => {
					this.chase = !this.chase;
				});
			},
			tick: function (t, dt) {
				if (!this.chase) return;
				var currentPosition = this.el.object3D.position;
				var distanceToCam = currentPosition.distanceTo(
					this.target.object3D.position
				);
				if (distanceToCam < 1.2) {
					return;
				}
				var targetPos = this.el.object3D.worldToLocal(
					this.target.object3D.position.clone()
				);
				// console.log('targetPos', targetPos);
				// targetPos.y = -1.6;
				var distance = (dt * this.data.speed) / 4000;
				this.el.object3D.translateOnAxis(targetPos, distance);
			},
		});

		AFRAME.registerComponent('sphere-set-color', {
			init: function () {
				this.el.addEventListener('click', () => {
					console.log(
						'color of the clicked sphere',
						this.el.getAttribute('material').color
					);
					color = this.el.getAttribute('material').color;
				});
			},
		});

		const changeColor = (el, component, exclude) => {
			const obj = el.getObject3D('mesh');
			console.log('3D object', obj);
			leather_pick = (leather_pick + 1) % 2;
			if (component === 'leather') color = colors[leather_pick];
			obj.traverse((node) => {
				if (node.isMesh) {
					// console.log(node.name);
					if (
						node.name.indexOf(component) !== -1 &&
						(exclude === '' || node.name.indexOf(exclude) === -1)
					) {
						node.material.color.set(color);
					}
				}
			});
		};

		AFRAME.registerComponent('change-color', {
			schema: {
				color: { type: 'string', default: '#ff0000' },
				component: { type: 'string', default: '' },
				exclude: { type: 'string', defualt: '' },
				name: { type: 'string', default: 'maserati_gltf' },
			},
			init: function () {
				var el = this.el;
				// console.log("color: ", this.data);
				el.addEventListener('click', () => {
					var element = document.getElementById(this.data.name);
					// if (this.data.component == 'leather') color = !color;
					changeColor(
						element,
						// this.data.color,
						this.data.component,
						this.data.exclude
					);
				});
			},
		});

		var maserati_int_cam_switch = document.getElementById(
			'maserati_int_cam_switch_1'
		);
		console.log('cam', maserati_int_cam_switch);
		var maserati_ext_cam_switch = document.getElementById(
			'maserati_ext_cam_switch'
		);
		var maserati_interior_cam = document.getElementById(
			'maserati_interior_cam'
		);
		var ext_cam = document.getElementById('ext_cam');
		maserati_int_cam_switch.addEventListener('click', () => {
			console.log('Switched to interior cam');
			maserati_interior_cam.setAttribute('active', 'true');
			ext_cam.setAttribute('active', 'false');
		});

		maserati_ext_cam_switch.addEventListener('click', () => {
			console.log('Switched to exterior cam');
			maserati_interior_cam.setAttribute('active', 'false');
			ext_cam.setAttribute('active', 'true');
		});
	</script>
</html>
